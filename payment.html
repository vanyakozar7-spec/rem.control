<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PÅ‚atnoÅ›Ä‡ â€” Remont Control</title>
  <meta name="description" content="PÅ‚atnoÅ›Ä‡ online za wybrany pakiet Remont Control." />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

<header class="nav">
  <div class="container nav-inner">
    <a class="brand" href="./">
      <img src="logo.png" alt="Remont Control" class="logo-main" />
    </a>

    <nav class="menu">
      <a href="about.html">O serwisie</a>
      <a href="terms.html">Zasady</a>
      <a class="btn" href="check.html">SprawdÅº swÃ³j remont</a>
    </nav>
  </div>
</header>

<main class="container pay-wrap">

  <section class="hero">
    <div class="card">
      <h1 class="h1">PÅ‚atnoÅ›Ä‡ online</h1>
      <p class="lead">
        SprawdÅº podsumowanie. Po opÅ‚aceniu zamÃ³wienia dostaniesz potwierdzenie i zaczynamy analizÄ™.
      </p>
    </div>
  </section>

  <section class="section">
    <div class="pay-grid">

      <!-- SUMMARY -->
      <div class="card">
        <h2 class="h2">Podsumowanie</h2>

        <div class="kv"><div>Pakiet</div><div id="sumPlan">â€”</div></div>
        <div class="kv"><div>Cena</div><div id="sumPrice">â€”</div></div>
        <div class="kv"><div>E-mail</div><div id="sumEmail">â€”</div></div>

        <p class="small muted" style="margin-top:12px;">
          Po pÅ‚atnoÅ›ci otrzymasz e-mail z potwierdzeniem.
        </p>
      </div>

      <!-- PAYMENT -->
      <div class="card">
        <h2 class="h2">OpÅ‚aÄ‡ zamÃ³wienie</h2>

        <button class="btn" id="payBtn" type="button">OpÅ‚aÄ‡ teraz</button>

        <hr class="divider" />

        <!-- âœ… TEST BUTTON -->
        <p class="small muted">
          ğŸ”§ Tryb testowy (bez opÅ‚aty):
        </p>
        <button class="btn secondary" id="testSendBtn" type="button">
          Test: wyÅ›lij zgÅ‚oszenie bez pÅ‚atnoÅ›ci
        </button>

      </div>

    </div>
  </section>

</main>

<footer class="footer">
  <div class="container">
    <p class="small">
      Remont Control â€” serwis informacyjno-kontrolny.
    </p>
  </div>
</footer>

<script>
(function () {

  const PRICES = { BASIC:"149 zÅ‚", PLUS:"299 zÅ‚", PREMIUM:"499 zÅ‚" };
  const FORMSUBMIT_ENDPOINT = "https://formsubmit.co/ajax/remontcontrol.info@gmail.com";
  const THANKS_URL = "thank-you.html";
  const STORAGE_KEY = "remontcontrol_lead";

  function getLead(){
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY)); }
    catch(e){ return null; }
  }

  function normalizePlan(lead){
    const p = (lead && (lead["Wybrany pakiet"] || lead["Pakiet (wybÃ³r)"])) || "PLUS";
    return String(p).toUpperCase();
  }

  async function sendLead(lead){
    if (!lead) throw new Error("Brak danych formularza");

    const payload = {
      _subject: "Nowe zgÅ‚oszenie â€” Remont Control",
      _template: "table",
      _captcha: "false",
      _replyto: lead["E-mail"] || "",
      ...lead
    };

    const res = await fetch(FORMSUBMIT_ENDPOINT, {
      method:"POST",
      headers:{ "Content-Type":"application/json","Accept":"application/json" },
      body:JSON.stringify(payload)
    });

    if (!res.ok) throw new Error("BÅ‚Ä…d wysyÅ‚ki");
  }

  const lead = getLead();
  const plan = normalizePlan(lead);

  document.getElementById("sumPlan").textContent = plan;
  document.getElementById("sumPrice").textContent = PRICES[plan] || "â€”";
  document.getElementById("sumEmail").textContent = lead?.["E-mail"] || "â€”";

  document.getElementById("payBtn").onclick = async () => {
    await sendLead(lead);
    window.location.href = THANKS_URL;
  };

  document.getElementById("testSendBtn").onclick = async () => {
    await sendLead(lead);
    window.location.href = THANKS_URL;
  };

})();
</script>

</body>
</html>
