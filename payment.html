<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PÅ‚atnoÅ›Ä‡ â€” Remont Control</title>
  <meta name="description" content="PÅ‚atnoÅ›Ä‡ online za wybrany pakiet Remont Control." />
  <link rel="stylesheet" href="styles.css" />

  <!-- FAVICON / APP ICONS -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
</head>

<body>

<header class="nav">
  <div class="container nav-inner">

    <!-- LOGO (CSS, stacked like your PNG) -->
    <a class="brand brand-stacked" href="./" aria-label="Remont Control">
      <span class="logo-top">Remont</span>
      <span class="logo-bottom">
        <span class="logo-control">Control</span>
        <span class="logo-check">âœ“</span>
      </span>
    </a>

    <nav class="menu">
      <a href="about.html">O serwisie</a>
      <a href="terms.html">Zasady</a>
      <a class="btn" href="check.html">SprawdÅº swÃ³j remont</a>
    </nav>

  </div>
</header>

<main class="container pay-wrap">

  <section class="hero">
    <div class="card">
      <h1 class="h1">PÅ‚atnoÅ›Ä‡ online</h1>
      <p class="lead">
        SprawdÅº podsumowanie. Po opÅ‚aceniu zamÃ³wienia dostaniesz potwierdzenie i zaczynamy analizÄ™.
      </p>
      <p class="notice" style="margin-top:12px;">
        JeÅ›li nie widzisz danych â€” wrÃ³Ä‡ do formularza i wyÅ›lij go ponownie.
      </p>
    </div>
  </section>

  <section class="section">
    <div class="pay-grid">

      <!-- LEFT: SUMMARY -->
      <div class="card">
        <h2 class="h2">Podsumowanie</h2>

        <div class="kv">
          <div class="k">Pakiet</div>
          <div class="v" id="sumPlan">â€”</div>
        </div>
        <div class="kv">
          <div class="k">Cena</div>
          <div class="v" id="sumPrice">â€”</div>
        </div>
        <div class="kv">
          <div class="k">E-mail</div>
          <div class="v" id="sumEmail">â€”</div>
        </div>
        <div class="kv">
          <div class="k">Miasto</div>
          <div class="v" id="sumCity">â€”</div>
        </div>
        <div class="kv">
          <div class="k">MetraÅ¼</div>
          <div class="v" id="sumArea">â€”</div>
        </div>

        <div class="smallgap"></div>

        <p class="small muted">
          Po pÅ‚atnoÅ›ci otrzymasz e-mail z potwierdzeniem oraz dalszymi instrukcjami.
        </p>
        <p class="small muted">
          Uwaga: Remont Control nie wykonuje remontÃ³w i nie odpowiada za pracÄ™ wykonawcy.
        </p>
      </div>

      <!-- RIGHT: PAY -->
      <div class="card">
        <h2 class="h2">OpÅ‚aÄ‡ zamÃ³wienie</h2>

        <p class="small muted">
          Tryb MVP (bez serwera): pÅ‚atnoÅ›Ä‡ realizujesz przez link pÅ‚atnoÅ›ci / checkout.
          JeÅ›li linki nie sÄ… podpiÄ™te â€” przycisk wyÅ›le zgÅ‚oszenie (testowo) i przeniesie do podziÄ™kowania.
        </p>

        <div class="notice" style="margin-top:12px;">
          <strong>Do podÅ‚Ä…czenia:</strong> wklej swoje linki pÅ‚atnoÅ›ci w sekcji <span class="mono">PAYMENT_LINKS</span>.
        </div>

        <div style="margin-top:16px;">
          <button class="btn" id="payBtn" type="button">OpÅ‚aÄ‡ teraz</button>
          <a class="btn secondary" href="check.html" style="margin-left:10px;">WrÃ³Ä‡</a>
        </div>

        <p class="small muted" style="margin-top:10px;">
          KlikajÄ…c â€OpÅ‚aÄ‡ terazâ€ akceptujesz <a href="terms.html">zasady</a>.
        </p>

        <hr class="divider" />

        <!-- âœ… TEST BUTTON (ALWAYS VISIBLE) -->
        <p class="small muted">
          ğŸ”§ Test (bez opÅ‚aty): wyÅ›lij zgÅ‚oszenie na e-mail i przejdÅº dalej.
        </p>
        <button class="btn secondary" id="testSendBtn" type="button">
          Test: wyÅ›lij zgÅ‚oszenie bez pÅ‚atnoÅ›ci
        </button>

        <p class="small muted" style="margin-top:10px;">
          Przed reklamÄ… usuÅ„ ten przycisk albo schowaj go.
        </p>
      </div>

    </div>
  </section>

</main>

<footer class="footer">
  <div class="container">
    <p class="small">
      Remont Control to serwis informacyjno-kontrolny. Nie jesteÅ›my stronÄ… umowy i nie gwarantujemy kosztu ani rezultatu prac.
      WideÅ‚ki sÄ… orientacyjne i zaleÅ¼Ä… od wielu czynnikÃ³w (miasto, metraÅ¼, stan, standard).
    </p>
    <p class="small" style="margin-top:8px;">
      <a href="./">Strona gÅ‚Ã³wna</a> â€¢ <a href="about.html">O serwisie</a> â€¢ <a href="terms.html">Zasady</a>
    </p>
  </div>
</footer>

<script>
(function () {
  // =========================
  // CONFIG
  // =========================
  const PRICES = { BASIC: "149 zÅ‚", PLUS: "299 zÅ‚", PREMIUM: "499 zÅ‚" };

  // If link exists -> redirect to payment
  // If empty -> fallback to send lead + thanks (MVP)
  const PAYMENT_LINKS = {
    BASIC: "",
    PLUS: "",
    PREMIUM: ""
  };

  // âœ… Your receiver email
  const FORMSUBMIT_ENDPOINT = "https://formsubmit.co/ajax/remontcontrol.info@gmail.com";

  // âœ… Your thanks page filename in repo
  const THANKS_URL = "thank-you.html";

  // localStorage key
  const STORAGE_KEY = "remontcontrol_lead";

  // =========================
  // HELPERS
  // =========================
  function safeText(v){ return (v === undefined || v === null || v === "") ? "â€”" : String(v); }

  function getLead(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch(e){
      return null;
    }
  }

  function normalizePlan(lead){
    const pRaw = lead && (lead["Wybrany pakiet"] || lead["Pakiet (wybÃ³r)"]);
    const p = pRaw ? String(pRaw).toUpperCase() : "PLUS";
    return (p === "BASIC" || p === "PLUS" || p === "PREMIUM") ? p : "PLUS";
  }

  function fillSummary(lead){
    const plan = normalizePlan(lead);
    document.getElementById("sumPlan").textContent  = plan;
    document.getElementById("sumPrice").textContent = PRICES[plan] || "â€”";
    document.getElementById("sumEmail").textContent = safeText(lead && (lead["E-mail"] || lead["Email"]));
    document.getElementById("sumCity").textContent  = safeText(lead && (lead["Miasto / wojewÃ³dztwo"] || lead["Miasto"]));
    document.getElementById("sumArea").textContent  = safeText(lead && lead["MetraÅ¼ (mÂ²)"]);
  }

  async function sendLeadToEmail(lead){
    if (!lead) throw new Error("Brak danych zgÅ‚oszenia. WrÃ³Ä‡ do check.html i wyÅ›lij formularz ponownie.");

    const replyTo = (lead["E-mail"] || lead["Email"] || "").trim();

    const payload = {
      _subject: "Nowe zgÅ‚oszenie â€” Remont Control",
      _template: "table",
      _captcha: "false",
      _replyto: replyTo,
      ...lead
    };

    const res = await fetch(FORMSUBMIT_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type":"application/json", "Accept":"application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      const txt = await res.text().catch(()=> "");
      throw new Error("BÅ‚Ä…d wysyÅ‚ki: " + res.status + " " + txt);
    }
    return true;
  }

  function goThanks(){
    window.location.href = THANKS_URL;
  }

  // =========================
  // INIT
  // =========================
  const lead = getLead();
  fillSummary(lead);
  const plan = normalizePlan(lead);

  const payBtn = document.getElementById("payBtn");
  const testSendBtn = document.getElementById("testSendBtn");

  // =========================
  // ACTIONS
  // =========================
  payBtn.addEventListener("click", async function(){
    const link = (PAYMENT_LINKS[plan] || "").trim();

    if (link) {
      window.location.href = link;
      return;
    }

    // Fallback (no links yet): send + thanks
    payBtn.disabled = true;
    payBtn.textContent = "WysyÅ‚amâ€¦";

    try {
      await sendLeadToEmail(lead);
      goThanks();
    } catch(e){
      alert("Nie udaÅ‚o siÄ™ wysÅ‚aÄ‡ zgÅ‚oszenia.\n\n" + e.message);
      payBtn.disabled = false;
      payBtn.textContent = "OpÅ‚aÄ‡ teraz";
    }
  });

  // âœ… Test always visible
  testSendBtn.addEventListener("click", async function(){
    testSendBtn.disabled = true;
    testSendBtn.textContent = "WysyÅ‚amâ€¦";

    try {
      await sendLeadToEmail(lead);
      goThanks();
    } catch(e){
      alert("BÅ‚Ä…d wysyÅ‚ki: " + e.message);
      testSendBtn.disabled = false;
      testSendBtn.textContent = "Test: wyÅ›lij zgÅ‚oszenie bez pÅ‚atnoÅ›ci";
    }
  });

})();
</script>

</body>
</html>
