<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Płatność — Remont Control</title>
  <meta name="description" content="Płatność online za wybrany pakiet Remont Control." />
  <link rel="stylesheet" href="styles.css" />

  <style>
    .pay-wrap { max-width: 860px; margin: 0 auto; }
    .pay-grid { display:grid; grid-template-columns: 1.2fr .8fr; gap: 14px; }
    @media (max-width: 900px){ .pay-grid{ grid-template-columns: 1fr; } }

    .kv { display:flex; justify-content:space-between; gap:12px; padding:10px 0; border-bottom:1px solid rgba(255,255,255,.08); }
    .kv:last-child{ border-bottom:none; }
    .kv .k{ opacity:.85; }
    .kv .v{ font-weight:600; text-align:right; }

    .muted { opacity:.85; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
    .smallgap { height:10px; }
  </style>
</head>

<body>

<header class="nav">
  <div class="container nav-inner">

    <!-- ONLY LOGO -->
    <a class="brand" href="./">
      <img src="logo.png" alt="Remont Control" class="logo-main" />
    </a>

    <nav class="menu">
      <a href="about.html">O serwisie</a>
      <a href="terms.html">Zasady</a>
      <a class="btn" href="check.html">Sprawdź swój remont</a>
    </nav>

  </div>
</header>

<main class="container pay-wrap">

  <section class="hero">
    <div class="card">
      <h1 class="h1">Płatność online</h1>
      <p class="lead">
        Sprawdź podsumowanie. Po opłaceniu zamówienia dostaniesz potwierdzenie i zaczynamy analizę.
      </p>
      <p class="notice" style="margin-top:12px;">
        Jeśli nie widzisz danych — wróć do formularza i wyślij go ponownie.
      </p>
    </div>
  </section>

  <section class="section">
    <div class="pay-grid">

      <!-- LEFT: SUMMARY -->
      <div class="card">
        <h2 class="h2">Podsumowanie</h2>

        <div class="kv">
          <div class="k">Pakiet</div>
          <div class="v" id="sumPlan">—</div>
        </div>
        <div class="kv">
          <div class="k">Cena</div>
          <div class="v" id="sumPrice">—</div>
        </div>
        <div class="kv">
          <div class="k">E-mail</div>
          <div class="v" id="sumEmail">—</div>
        </div>
        <div class="kv">
          <div class="k">Miasto</div>
          <div class="v" id="sumCity">—</div>
        </div>
        <div class="kv">
          <div class="k">Metraż</div>
          <div class="v" id="sumArea">—</div>
        </div>

        <div class="smallgap"></div>

        <p class="small muted">
          Po płatności otrzymasz e-mail z potwierdzeniem oraz dalszymi instrukcjami.
        </p>
        <p class="small muted">
          Uwaga: Remont Control nie wykonuje remontów i nie odpowiada za pracę wykonawcy.
        </p>
      </div>

      <!-- RIGHT: PAY -->
      <div class="card">
        <h2 class="h2">Opłać zamówienie</h2>

        <p class="small muted">
          Tryb MVP (bez serwera): płatność realizujesz przez link płatności / checkout, a po sukcesie wracasz na stronę.
        </p>

        <!-- 1) Put your payment links here (optional) -->
        <div class="notice" style="margin-top:12px;">
          <strong>Do podłączenia:</strong> wklej swój link płatności dla każdego pakietu w kodzie (sekcja <span class="mono">PAYMENT_LINKS</span>).
        </div>

        <div style="margin-top:16px;">
          <button class="btn" id="payBtn" type="button">Opłać teraz</button>
          <a class="btn secondary" href="check.html" style="margin-left:10px;">Wróć</a>
        </div>

        <p class="small muted" style="margin-top:10px;">
          Klikając „Opłać teraz” akceptujesz <a href="terms.html">zasady</a>.
        </p>

        <hr class="divider" />

        <!-- 2) DEMO / TEST (optional) -->
        <p class="small muted">
          Test: jeśli jeszcze nie masz płatności, możesz użyć przycisku poniżej do sprawdzenia wysyłki leadów.
        </p>
        <button class="btn secondary" id="testSendBtn" type="button">Test: wyślij zgłoszenie bez płatności</button>

        <p class="small muted" style="margin-top:10px;">
          Ten przycisk jest tylko do testów — usuń go przed reklamą.
        </p>
      </div>

    </div>
  </section>

</main>

<footer class="footer">
  <div class="container">
    <p class="small">
      Remont Control to serwis informacyjno-kontrolny. Nie jesteśmy stroną umowy i nie gwarantujemy kosztu ani rezultatu prac.
    </p>
  </div>
</footer>

<script>
(function () {
  // --- CONFIG ---
  const PRICES = { BASIC: "149 zł", PLUS: "299 zł", PREMIUM: "499 zł" };

  // PAYMENT_LINKS:
  // Вставиш сюди реальні лінки оплати, коли будуть (PayU/Przelewy24/Stripe Payment Link тощо)
  // Можна залишити порожнім і користуватись Test mode.
  const PAYMENT_LINKS = {
    BASIC: "",   // e.g. "https://buy.stripe.com/...."
    PLUS: "",
    PREMIUM: ""
  };

  // FormSubmit endpoint (email receiver)
  const FORMSUBMIT_ENDPOINT = "https://formsubmit.co/ajax/vanyakozar7@gmail.com";

  // Where to go after "success" (we will send lead then redirect)
  const THANKS_URL = "thanks.html";

  // localStorage key
  const STORAGE_KEY = "remontcontrol_lead";

  // --- HELPERS ---
  function safeText(v){ return (v === undefined || v === null || v === "") ? "—" : String(v); }

  function getLead(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch(e){
      return null;
    }
  }

  function normalizePlan(lead){
    const p = (lead && (lead["Wybrany pakiet"] || lead["Pakiet (wybór)"])) ? String(lead["Wybrany pakiet"] || lead["Pakiet (wybór)"]).toUpperCase() : "PLUS";
    return (p === "BASIC" || p === "PLUS" || p === "PREMIUM") ? p : "PLUS";
  }

  function fillSummary(lead){
    const plan = normalizePlan(lead);
    document.getElementById("sumPlan").textContent  = plan;
    document.getElementById("sumPrice").textContent = PRICES[plan] || "—";
    document.getElementById("sumEmail").textContent = safeText(lead && (lead["E-mail"] || lead["Email"]));
    document.getElementById("sumCity").textContent  = safeText(lead && (lead["Miasto / województwo"] || lead["Miasto"]));
    document.getElementById("sumArea").textContent  = safeText(lead && (lead["Metraż (m²)"] || lead["Metraż (m²) "])) ;
  }

  async function sendLeadToEmail(lead){
    if (!lead) throw new Error("No lead data");

    // IMPORTANT: FormSubmit accepts normal form fields.
    // We'll send as JSON (AJAX endpoint).
    const payload = {
      _subject: "Nowe zgłoszenie — Remont Control",
      _template: "table",
      _captcha: "false",
      ...lead
    };

    const res = await fetch(FORMSUBMIT_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type":"application/json", "Accept":"application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      const txt = await res.text().catch(()=> "");
      throw new Error("Send failed: " + res.status + " " + txt);
    }
    return true;
  }

  function goThanks(){
    window.location.href = THANKS_URL;
  }

  // --- INIT ---
  const lead = getLead();
  fillSummary(lead);

  const plan = normalizePlan(lead);

  // --- BUTTONS ---
  const payBtn = document.getElementById("payBtn");
  const testSendBtn = document.getElementById("testSendBtn");

  // MVP flow:
  // 1) If you have PAYMENT_LINK for selected plan -> go there.
  // 2) If no link -> fallback: send lead and go to thanks (for now)
  payBtn.addEventListener("click", async function(){
    const link = (PAYMENT_LINKS[plan] || "").trim();

    if (link) {
      // Redirect to real payment link.
      // After payment you should configure provider to redirect back to: /payment_success.html (optional)
      window.location.href = link;
      return;
    }

    // Fallback (no payment link yet): send now, then thanks
    payBtn.disabled = true;
    payBtn.textContent = "Wysyłam…";

    try {
      await sendLeadToEmail(lead);
      goThanks();
    } catch(e){
      alert("Nie udało się wysłać zgłoszenia. Wróć do formularza i spróbuj ponownie.\n\n" + e.message);
      payBtn.disabled = false;
      payBtn.textContent = "Opłać teraz";
    }
  });

  // Test mode: always send + thanks
  testSendBtn.addEventListener("click", async function(){
    testSendBtn.disabled = true;
    testSendBtn.textContent = "Wysyłam…";

    try {
      await sendLeadToEmail(lead);
      goThanks();
    } catch(e){
      alert("Błąd wysyłki: " + e.message);
      testSendBtn.disabled = false;
      testSendBtn.textContent = "Test: wyślij zgłoszenie bez płatności";
    }
  });

})();
</script>

</body>
</html>
